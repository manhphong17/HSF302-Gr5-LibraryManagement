<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Nạp tiền</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<h3 class="mb-4">Nạp tiền vào tài khoản</h3>

<!-- Alerts theo flash attribute từ controller -->
<div th:if="${depositMsg}" class="alert alert-success alert-dismissible fade show" role="alert">
    <span th:text="${depositMsg}">Nạp thành công</span>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
<div th:if="${depositError}" class="alert alert-danger alert-dismissible fade show" role="alert">
    <span th:text="${depositError}">Có lỗi xảy ra</span>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>

<!-- Nếu bạn có object reader thì có thể bật block này, còn không thì để ẩn an toàn -->
<div class="card mb-3" th:if="${reader}">
    <div class="card-body">
        <div class="row g-3 align-items-center">
            <div class="col-md-3"><strong>Mã sinh viên:</strong> <span th:text="${reader.studentCode}">SV0001</span></div>
            <div class="col-md-3"><strong>Họ tên:</strong> <span th:text="${reader.fullName}">Nguyễn Văn A</span></div>
            <div class="col-md-3"><strong>Số dư hiện tại:</strong> <span th:text="${#numbers.formatInteger(reader.balance,0)}">0</span> đ</div>
            <!-- Nếu model của bạn không có reader.id thì ẩn nút này hoặc sửa field cho đúng -->
            <div class="col-md-3" th:if="${reader.id != null}">
                <a th:href="@{'/reader/details/' + ${reader.id}}" class="btn btn-sm btn-outline-secondary">Chi tiết</a>
            </div>
        </div>
    </div>
</div>

<!-- FORM nạp tiền: name field trùng với @RequestParam của controller -->
<form action="/librarian/deposit" method="post" class="card p-3 shadow-sm">
    <div class="row g-3">
        <div class="col-md-4">
            <label class="form-label">Mã sinh viên</label>
            <input type="text" name="studentCode" class="form-control" placeholder="VD: SE12345" required
                   th:value="${depositDTO != null} ? ${depositDTO.studentCode} : ${null}">
        </div>

        <div class="col-md-4">
            <label class="form-label">ID thủ thư</label>
            <input type="number" name="librarianId" class="form-control" placeholder="VD: 1" required
                   th:value="${depositDTO != null} ? ${depositDTO.librarianId} : ${null}">
        </div>

        <div class="col-md-4">
            <label class="form-label">Số tiền nạp (đ)</label>
            <input type="number" name="amount" min="1000" step="1000" class="form-control" placeholder="VD: 50000" required
                   th:value="${depositDTO != null} ? ${depositDTO.amount} : ${null}">
            <div class="form-text">Tối thiểu 1.000đ; tối đa 10.000.000đ/lần.</div>
        </div>

        <div class="col-12">
            <label class="form-label">Ghi chú</label>
            <input type="text" name="note" maxlength="255" class="form-control" placeholder="VD: Nạp tiền tại quầy"
                   th:value="${depositDTO != null} ? ${depositDTO.note} : ${null}">
        </div>

        <div class="col-12 d-flex gap-2">
            <button class="btn btn-success" type="submit">
                <i class="fas fa-money-bill-wave me-1"></i> Xác nhận nạp
            </button>
            <a th:href="@{/librarian/search-reader}" class="btn btn-outline-secondary">Chọn Reader khác</a>
        </div>
    </div>
</form>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Auto-hide alert sau 2.5s
    window.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.alert').forEach(a=>{
            setTimeout(()=>bootstrap.Alert.getOrCreateInstance(a).close(), 2500);
        });
    });
</script>
</body>
</html>
